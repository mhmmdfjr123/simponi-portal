var formatCurrency=function(a){return a.replace(/(?!^)(?=(?:\d{3})+(?:\.|$))/gm,".")},presentValue=function(a,t,e,n){return t<1?0:a>0?-(Math.pow(1+a,-t)*(n*a-e+Math.pow(1+a,t)*e))/a:-(n+e*t)},periodicPayment=function(a,t,e,n,i){if(a>0){var l=Math.pow(1+a,t);return-(a*(n+l*e))/((-1+l)*(1+a*i))}return t>0?-(n+e)/t:0};$("input.currency").numeric().keydown(function(){$(this).val($(this).val().replace(/\./g,""))}).keyup(function(){$(this).val().length>0?$(this).attr("data-value",$(this).val()).val(formatCurrency($(this).val())):$(this).attr("data-value",0)}),$("input.percentage").numeric().keyup(function(){$(this).val().length>0?$(this).attr("data-value",parseFloat($(this).val())/100):$(this).attr("data-value",0)}),$('input[name="topupRadio"]').click(function(){$(this).parent().is(":first-child")?$("input#starting-balance").attr("disabled",!0).removeAttr("required"):$("input#starting-balance").removeAttr("disabled").attr("required",!0)}),$('input[name="billingRadio"]').click(function(){var a=$(this).parent().index()<1?"Bulan":"Tahun";$(".billing label").text("Iuran Per "+a),$(".billing input").attr("placeholder","Masukkan Iuran Per "+a).removeAttr("disabled"),$("#billing-increment").removeAttr("disabled")}),$("input, select").focus(function(){$(this).closest(".form-group").children(".validation-warning").remove()}),$("input[data-target]").keyup(function(){var a=$(this).data("target").split(",");for(var t in a)$(a[t]).click()}),$("select[data-target]").change(function(){var a=$(this).data("target").split(",");for(var t in a)$(a[t]).click()}),$("#duration").click(function(){var a=parseInt($("#retirement-age option:selected").data("value")),t=parseInt($("#age option:selected").data("value")),e=a-t;$(this).val(e+" tahun").attr("data-value",e)}),$("#duration-after").click(function(){var a=parseInt($("#life-expectancy option:selected").data("value")),t=parseInt($("#retirement-age option:selected").data("value")),e=a-t;$(this).val(e+" tahun").attr("data-value",e)}),$("#living-cost-after").click(function(){for(var a=parseInt($("#living-cost").attr("data-value")),t=parseFloat($("#inflation-rate").attr("data-value")),e=parseInt($("#duration").attr("data-value")),n=1;n<=e;n++)a+=a*t;$(this).val(formatCurrency(parseInt(a).toString())).attr("data-value",a)}),$("#living-cost-total").click(function(){var a=parseFloat($("#living-cost-after").attr("data-value")),t=parseFloat($("#inflation-rate").attr("data-value")),e=1.075/(1+t)-1;durationafter=parseInt($("#duration-after").attr("data-value")),pv=presentValue(e/12,12*durationafter,-a,0),$(this).val(formatCurrency(parseInt(pv).toString())).attr("data-value",pv)}),$('[data-toggle="tooltip"]').tooltip();var ctx=$("canvas#simulation"),getYAxes=function(){return[{ticks:{beginAtZero:!0,callback:function(a){var t=parseInt(a);return"Rp"+(t>=1e3?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):t)}}}]},getTooltips=function(){return{callbacks:{label:function(a){var t=parseInt(a.yLabel);return"Rp"+(t>=1e3?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):t)}}}},getDatasets=function(a,t,e,n,i,l){return{label:a,backgroundColor:t,borderColor:e,pointBackgroundColor:n,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:i,data:l}},getChart=function(a){return{type:"line",data:{labels:a[0],datasets:[getDatasets("Dana Awal","rgba(49,133,156,.2)","rgba(49,133,156,1)","rgba(49,133,156,1)","rgba(49,133,156,1)",a[1]),getDatasets("Iuran","rgba(192,80,77,.2)","rgba(192,80,77,1)","rgba(192,80,77,1)","rgba(192,80,77,1)",a[2]),getDatasets("Pengembangan","rgba(119,147,60,.2)","rgba(119,147,60,1)","rgba(119,147,60,1)","rgba(119,147,60,1)",a[3]),getDatasets("Saldo Akhir","rgba(179,181,198,.2)","rgba(179,181,198,1)","rgba(179,181,198,1)","rgba(179,181,198,1)",a[4])]},options:{scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Usia (dalam tahun)"}}],yAxes:getYAxes()},tooltips:getTooltips()}}},myChart=ctx.length>0?new Chart(ctx,getChart([[40,45,50,55,60],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]])):null;$(".calculate").click(function(){var a=$(this).closest("form");$(".date-control > *");if(a.validate()){if(a.hasClass("rev")){var t=parseFloat($("#investation-rate option:selected").data("value"));duration=parseInt($("#duration").attr("data-value")),livingcosttotal=parseInt($("#living-cost-total").attr("data-value")),monthlyinvestation=periodicPayment(t/12,12*duration,0,-livingcosttotal,0),annualinvestation=periodicPayment(t,duration,0,-livingcosttotal,0),lumpsum=presentValue(t,duration,0,-livingcosttotal);var e=function(a){return{number:a,numberStep:$.animateNumber.numberStepFactories.separator(".")}};$("#monthly-investation span").text("Rp").siblings("b").animateNumber(e(monthlyinvestation),1800),$("#annual-investation span").text("Rp").siblings("b").animateNumber(e(annualinvestation),1800),$("#lumpsum span").text("Rp").siblings("b").animateNumber(e(lumpsum),1800)}else{var n=parseInt($("#age option:selected").attr("data-value")),i=parseInt($("#retirement-age option:selected").attr("data-value")),l=12*(i-n),r=[[],[],[],[],[]];countlast=l/60,countlast=countlast>4?4:countlast-1,isannualstartingbalance=$('input[name="topupRadio"]:checked').parent().is(":last-child"),startingbalance=parseFloat($("#starting-balance").attr("data-value")),accumulatedstartingbalance=startingbalance,isannualbilling=$('input[name="billingRadio"]:checked').parent().is(":last-child"),billing=parseFloat($(".billing input.currency").attr("data-value")),accumulatedbilling=billing,billingincrement=parseFloat($("#billing-increment").attr("data-value")),interestrate=parseFloat($("#interest-rate option:selected").attr("data-value")),monthlyinterestrate=interestrate/12,administrationfee=parseFloat($("#administration-fee").attr("data-value")),managementfee=parseFloat($("#management-fee").attr("data-value")),accumulatedfund=startingbalance+billing+(startingbalance+billing)*monthlyinterestrate,isnewyear=!1;for(var s=2;s<=l;s++){accumulatedstartingbalance=isannualstartingbalance&&isnewyear?accumulatedstartingbalance+startingbalance:accumulatedstartingbalance,accumulatedbilling=isannualbilling?isnewyear?accumulatedbilling+billing:accumulatedbilling:accumulatedbilling+billing,accumulatedfund=isannualstartingbalance&&isnewyear?accumulatedfund+startingbalance:accumulatedfund;var u=accumulatedfund+billing;if(accumulatedfund=isannualbilling?isnewyear?u+u*monthlyinterestrate:accumulatedfund+accumulatedfund*monthlyinterestrate:u+u*monthlyinterestrate,isnewyear=s%12==0,isnewyear){accumulatedfund-=administrationfee+accumulatedfund*managementfee,billing+=billing*billingincrement;var c=countlast-r[0].length;s==l-60*c&&(r[0].push(i-5*c),r[1].push(accumulatedstartingbalance),r[2].push(accumulatedbilling),r[3].push(accumulatedfund-(accumulatedstartingbalance+accumulatedbilling)),r[4].push(accumulatedfund),startingbalance=isannualstartingbalance?startingbalance:0)}}var e=function(a){return{number:a,numberStep:$.animateNumber.numberStepFactories.separator(".")}};$("#total-funding span").text("Rp").siblings("b").animateNumber(e(parseInt(accumulatedstartingbalance+accumulatedbilling)),1800),$("#total-development span").text("Rp").siblings("b").animateNumber(e(parseInt(r[3][r[3].length-1])),1800),$("#total-fund span").text("Rp").siblings("b").animateNumber(e(parseInt(accumulatedfund)),1800),$("iframe.chartjs-hidden-iframe").remove(),ctx.after('<canvas id="simulation" class="col-xs-12" height="250"></canvas>').remove(),ctx=$("canvas#simulation"),setTimeout(function(){myChart=new Chart(ctx,getChart(r))},500)}$('[href="#simulation"]').click()}else $('[href="#simulation-form"]').click()}),$.fn.validate=function(){var a=!0;return this.find("[required]").each(function(){var t=$(this).closest(".form-group"),e=t.children(".validation-warning");if(existingwarning=e.length>0,$(this).is("select")){var n=$(this).children("option:selected").index()>0;a=a&&n,n?existingwarning&&e.remove():!existingwarning&&t.append('<small class="validation-warning">Opsi di atas harus dipilih</small>')}else if($(this).is("input"))if($(this).is('[type="radio"]')||$(this).is('[type="checkbox"]')){var n=$(this).is(":checked")||$(this).closest("label").siblings().find(":checked").length>0;a=a&&n,n?existingwarning&&e.remove():!existingwarning&&t.append('<small class="validation-warning">Pilihan tidak boleh kosong</small>')}else{var n=$(this).val().length>0;if(a=a&&n,n&&$(this).is('[type="email"]')){var i=$(this).split("@"),l=i.length>1&&i[1].indexOf(".")>=0;a=a&&l,l?existingwarning&&e.remove():!existingwarning&&t.append('<small class="validation-warning">Email tidak valid</small>')}n?existingwarning&&e.remove():!existingwarning&&t.append('<small class="validation-warning">Kolom tidak boleh kosong</small>')}}),a};